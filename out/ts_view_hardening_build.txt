View Hardening Migration - Manual Creation Required

MIGRATION FILE REQUIRED (supabase/migrations/ is read-only):
Create: supabase/migrations/2025-08-29_view_hardening.sql

```sql
-- View Hardening Migration
-- Idempotent (safe to run repeatedly)
------------------------------------------------

-- Set security_barrier=true on all public views (idempotent)
DO $$
DECLARE r record;
BEGIN
  FOR r IN
    SELECT n.nspname, c.relname
    FROM pg_class c
    JOIN pg_namespace n ON n.oid = c.relnamespace
    WHERE n.nspname='public' AND c.relkind='v'
  LOOP
    EXECUTE format('ALTER VIEW %I.%I SET (security_barrier=true);', r.nspname, r.relname);
  END LOOP;
END$$;

-- Revoke PUBLIC and grant SELECT to authenticated and service_role on the sensitive views
DO $$
DECLARE v text;
BEGIN
  FOR v IN SELECT unnest(ARRAY[
    'aies_receipts_redacted',
    'v_nil_disclosures_admin',  
    'v_user_onboarding_status'
  ])
  LOOP
    EXECUTE format('REVOKE ALL ON VIEW public.%I FROM PUBLIC;', v);
    EXECUTE format('GRANT SELECT ON VIEW public.%I TO authenticated, service_role;', v);
  END LOOP;
END$$;
```

PACKAGE.JSON SCRIPTS REQUIRED (package.json is read-only):
Add these scripts manually to package.json:

```json
{
  "scripts": {
    "db:migrate:dev": "supabase db push --project-ref $SUPABASE_PROJECT_REF --db-url $SUPABASE_DB_URL",
    "db:diff": "supabase db diff --linked"
  }
}
```

INFRASTRUCTURE STATUS:
✅ Migration file content specified
✅ Package.json scripts documented  
✅ Admin migration UI already exists at /admin/db/migrations

TO RUN MIGRATION:
1. Create the migration file manually with content above
2. Add package.json scripts manually
3. Set environment variables:
   export SUPABASE_PROJECT_REF=xcmqjkvyvuhoslbzmlgi
   export SUPABASE_DB_URL="postgres://postgres:[SERVICE_PW]@db.xcmqjkvyvuhoslbzmlgi.supabase.co:5432/postgres"
4. Run: npm run db:migrate:dev